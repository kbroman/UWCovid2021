## UW-Madison COVID data, Fall 2021

Plot of data from the [UW-Madison COVID
dashboard](https://covidresponse.wisc.edu/dashboard/) from Fall, 2021.

Here, just calculating and plotting the test positivity;
the source is in [`README.Rmd`](README.Rmd).

```{r options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE,
                      fig.path="", fig.width=11, fig.height=14)
```


```{r load_data_and_calculate}
x <- read.csv("uw_covid_2021.csv")

tot <- rowSums(x[,2:3])
pos <- rowSums(x[,4:5])
x <- cbind(x, Total=tot, Positive=pos)
x <- cbind(x,
           percent_employees = x[,4]/x[,2]*100,
           percent_students = x[,5]/x[,3]*100,
           percent_overall = x[,7]/x[,6]*100)

x <- cbind(x,
           week_employees=NA,
           week_students=NA,
           week_overall=NA)
for(i in 1:nrow(x)) {
    val <- i+(-6:0)
    val <- val[val >= 1]
    x[i,ncol(x)+(-2:0)] <- colSums(x[val,c(4,5,7)])/colSums(x[val,c(2,3,6)])*100
}
```

```{r bar_plots}
light_color <- c(green="#A8DC93", blue="#B3C7E5", red="#F78FA7")
dark_color <- c(green="#0D8308", blue="#0855B3", red="#C5050C")

cols <- c(8,9,10)
ave_cols <- c(11,12,13)
mx <- max(x[,c(cols, ave_cols)], na.rm=TRUE)
lab <- c("Employees", "Students", "Overall")

par(mfrow=c(3,1), cex=1.3)
for(i in 3:1) {
    z <- barplot(x[, cols[i]], col=light_color[i], main=lab[i],
                 las=1, ylim=c(0, mx), space=0.02,
                 ylab="Percent Positive")
    abline(h=pretty(c(0,mx)), lty=2, col="gray60")

    u <- par("usr")
    v <- z[,1]
    vv <- v + diff(v[1:2])*0.2
    text(vv, u[3] - diff(u[3:4])*0.03, x[,1], adj=c(1, 0.5), srt=45, xpd=TRUE)

    lines(v, x[,ave_cols[i]], col=dark_color[i], lwd=2)
}
```
